#!/bin/bash

INSTALL_DIR="$HOME/.faah"
SOUND_FILE="$INSTALL_DIR/faah.mp3"
CONFIG_FILE="$INSTALL_DIR/enabled"

install_files() {
    mkdir -p "$INSTALL_DIR"
    cp "$(dirname "$0")/sounds/faah.mp3" "$SOUND_FILE"
}

inject_hook() {
    if ! grep -q "FAAAH_HOOK" "$HOME/.zshrc"; then
        cat << 'EOF' >> "$HOME/.zshrc"

# FAAAAH_HOOK
function __faah_hook() {
    if [[ -f "$HOME/.faah/enabled" && $? -ne 0 ]]; then
        afplay "$HOME/.faah/faah.mp3"
    fi
}
autoload -Uz add-zsh-hook
add-zsh-hook precmd __faah_hook
EOF
    fi
}

enable() {
    install_files
    inject_hook
    touch "$CONFIG_FILE"
    echo "FAAAH enabled ðŸ˜ˆ"
}

disable() {
    rm -f "$CONFIG_FILE"
    echo "FAAAH disabled ðŸ˜Œ"
}

case "$1" in
    on) enable ;;
    off) disable ;;
    *)
        echo "Usage: faah on | faah off"
        ;;
esac
